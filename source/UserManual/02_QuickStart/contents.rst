**第二章 快速开机启动**
=======================

2.1 开机前的准备
----------------

OKMX6ULL-S开发板有串口登录和网络登录两种系统登录方式，系统开机前硬件准备：

-  5V3A DC电源线

-  调试串口线（串口登录使用）

开发板上的调试串口为DB9公头，用户可使用双母头交叉串口线或者USB转RS232串口线连接开发板和PC机，以查看开发板状态信息。

-  网线（网络登录使用）

-  检查启动方式拨码开关

请检查您开发板上的拨码开关，确认已经拨到想要的启动方式，启动方式设置请参考“\ `*1.3
烧写及启动设置* <#_1.3  烧写及启动设置>`__\ ”

|Image\_20210907115108|

2.2 串口登录方式
----------------

2.2.1 串口登录
~~~~~~~~~~~~~~

-  **说明：**

-  **串口设置：波特率115200、数据位8、停止位1、无校验位、无流控制。**

-  **串口**\ \ **终端登陆使用root用户，无密码。若需修改密码参考:\ `*3.1.4.1
   FTP服务* <#_3.1.4  以太网相关服务>`__**

-  **软件需求：PC端Windows系统需要安装超级终端软件，超级终端软件有多种，可自行使用自己熟悉的串口终端软件。**

以下以putty为例介绍终端的设置方式：

**步骤一：**\ 使用串口线连接开发板和PC机，确认连接电脑的串口端口号，从“设备管理器”中查看串口端口号，以电脑实际识别的端口号为准。

|image1|

**步骤二：**\ 打开putty并设置，serial
line根据使用的电脑COM口设置，波特率115200

|image2|

|image3|

**步骤三：**\ 登录账户名为root，无密码

+----------------------------------------------------------------------+
| Freescale i.MX Release Distro 4.1.15-2.0.1 fl-imx6ull /dev/ttymxc0   |
|                                                                      |
| fl-imx6ull login: root                                               |
+----------------------------------------------------------------------+

**步骤四：**\ 查看内核版本信息

+----------------------------------------------------------------------------------------------------------+
| root@fl-imx6ull:~# uname -a                                                                              |
|                                                                                                          |
| **Linux fl-imx6ull 4.1.15-00035-g535f267 #1 SMP PREEMPT Wed Sep 9 15:20:52 CST 2020 armv7l GNU/Linux**   |
+----------------------------------------------------------------------------------------------------------+

从打印信息中可以看出，核心板内烧录的为linux4.1.15相关镜像

2.2.2 串口登录常见问题
~~~~~~~~~~~~~~~~~~~~~~

电脑端口没有串口的可以通过USB转串口线与开发板连接，使用USB转串口线接需要安装对应的驱动程序。

建议使用质量好串口线以避免出现乱码情况。

2.3 网络登录方式
----------------

2.3.1 网络连接测试
~~~~~~~~~~~~~~~~~~

-  **说明：console文件系统：默认出厂eth0的IP为192.168.0.232，eth1的IP为192.168.1.232**

**如果想修改默认IP，请修改/etc/network/interfaces**

**qt文件系统：默认出厂为动态获取IP，如需修改为静态IP，可在/etc/rc.local文件中添加如下
命令进行设置：ifconfig eth0 192.168.0.232**

开发板和电脑通过网线连接，测试网络连接状态，以开发板的eth0网卡为例(设置测试用电脑IP为192.168.0.58），以下在开发板串口登录方式下操作：

在进行网络登录前，需要先确保电脑和开发板直接的网络连接正常，可通过ping指令测试电脑和开发板的连接状态。具体方法操作如下：

1. 将开发板的eth0和电脑通过网线连接，给开发板上电，内核启动后核心板上会有蓝色心跳灯闪烁，与电脑连接的网卡在正常启动后网卡灯快速闪烁，此时可以测试网络连接。

|image4|

2、关闭电脑防火墙，打开电脑的运行命令

|image5|

3、使用cmd打开电脑管理员界面，使用ping指令测试电脑和开发板的网络连接状态

|image6|

有数据返回，网络连接正常。

2.3.2 SSH
~~~~~~~~~

-  **说明：**

-  **默认出厂使用SSH登录的账户：root密码:无。**

文件系统中移植的SSH是由dropbear实现，是一个相对较小的SSH服务器和客户端。开发板作为SSH服务器，其他主机可以

对Linux主机通过SSH访问开发板、windows主机通过SSH访问开发板两种方法进行操作说明，用户可根据实际情况设置账户密码后再操作，具体以实际情况的打印信息为准。

-  **Linux主机通过SSH访问开发板**

Linux主机需要先安装并开启SSH服务，才能通过SSH访问开发板，搭建方法可以参考应用笔记中相关文件，本次使用ubuntu开发环境作为Linux主机，此方法需要在Linux主机中进行操作。

1、配置信息：

Linux主机：IP为192.168.0.27，账户名为forlinx，主机名为ubuntu

开发板：IP为192.168.0.232，账户名为root，主机名为fl-imx6ull

2、测试Linux主机和开发板之间的网络连接状态

+------------------------------------------------------------------+
| forlinx@ubuntu:~$ ping -c 5 192.168.0.232 //-c 5指定ping5次      |
|                                                                  |
| PING 192.168.0.232 (192.168.0.232) 56(84) bytes of data.         |
|                                                                  |
| 64 bytes from 192.168.0.232: icmp\_seq=1 ttl=128 time=0.557 ms   |
|                                                                  |
| 64 bytes from 192.168.0.232: icmp\_seq=2 ttl=128 time=0.562 ms   |
|                                                                  |
| 64 bytes from 192.168.0.232: icmp\_seq=3 ttl=128 time=0.685 ms   |
|                                                                  |
| 64 bytes from 192.168.0.232: icmp\_seq=4 ttl=128 time=0.495 ms   |
|                                                                  |
| 64 bytes from 192.168.0.232: icmp\_seq=5 ttl=128 time=1.29 ms    |
|                                                                  |
| --- 192.168.0.232 ping statistics ---                            |
|                                                                  |
| 5 packets transmitted, 5 received, 0% packet loss, time 4074ms   |
|                                                                  |
| rtt min/avg/max/mdev = 0.495/0.718/1.291/0.293 ms                |
+------------------------------------------------------------------+

3、Linux主机通过SSH访问开发板

+----------------------------------------------------------------------------------+
| forlinx@ubuntu:~# ssh root@192.168.0.232                                         |
|                                                                                  |
| The authenticity of host '192.168.0.232 (192.168.0.232)' can't be established.   |
|                                                                                  |
| RSA key fingerprint is 8c:b8:9e:01:06:03:fb:f8:4c:4f:dd:db:79:28:d7:02.          |
|                                                                                  |
| Are you sure you want to continue connecting (yes/no)? yes //输入yes             |
|                                                                                  |
| Warning: Permanently added '192.168.0.232' (RSA) to the list of known hosts.     |
|                                                                                  |
| -sh: /home/root: Is a directory                                                  |
|                                                                                  |
| root@fl-imx6ull:~# //通过主机名可以看出SSH登录成功                               |
+----------------------------------------------------------------------------------+

通过账户信息可以确定ssh登录成功

4、退出SSH访问

+---------------------------------------------------------+
| **root@fl-imx6ull**: ~$ logout //退出SSH登录            |
|                                                         |
| Connection to 192.168.0.232 closed\ **.**               |
|                                                         |
| **forlinx@ubuntu**:~$ //通过主机名可以退出SSH登录成功   |
+---------------------------------------------------------+

-  **Windows主机通过SSH访问开发板**

|image7|

点击“Open”,出现如下对话框，点击“是”进入登录界面

|image8|

+-----------------------------------+
| Login as：root                    |
|                                   |
| -sh: /home/root: Is a directory   |
|                                   |
| root@fl-imx6ull:~#                |
+-----------------------------------+

2.4 屏幕选择
------------

OKMX6ULL-S平台支持4.3吋/5.6吋/7吋/8吋/10.4吋电阻屏，7吋电容屏，10.1吋LVDS的显示。系统启动默认使用的配置是7吋LCD的1024x600显示。

注意：使用飞凌的10.4吋（800x600）电阻屏时，请参考\ `*3.1.13.3触摸* <#_3.1.13  LCD 测试>`__\ 章节进行修改，默认为8吋屏800x600电阻触摸方向。

不同尺寸及不同分辨率的LCD显示，可以在启动阶段，通过U-boot菜单来选择。具体方法如下：

打开串口调试终端putty，开发板上电后按\ **空格键**\ 进入菜单首页：

    |image9|

Uboot一级菜单功能选项如下表：

+------------+---------------------------------------------------------+
| **序号**   | **功能选项**                                            |
+------------+---------------------------------------------------------+
| 1          | 进入到屏幕选择界面（出厂默认选择7寸-1024x600LCD显示）   |
+------------+---------------------------------------------------------+
| 2          | 进入是屏幕校准设置界面                                  |
+------------+---------------------------------------------------------+
| 9          | 进入到boot的命令行模式                                  |
+------------+---------------------------------------------------------+
| 0          | 进行reset复位操作                                       |
+------------+---------------------------------------------------------+

    输入\ **1**\ 进入屏幕选择菜单(Switch
    panel)，选择相应屏幕后系统重启：

|image10|

    根据菜单提示，选择相应选项来支持不同尺寸和分辨率的LCD显示。菜单的第1列为对应显示的菜单选择序号，第2列为屏幕支持的分辨率支持，第3列为系统屏幕的尺寸及类型（其中的c和r分别对应电容屏和电阻屏幕）。示例：如果需要选择800x480分辨率的7吋电容屏则需要选择1选项，终端界面输入数字1即可。

**注意：**\ 若使用我司自适应的屏幕则“屏幕选择菜单”将不可进入。

输入\ **2**\ 进入屏幕校准使能菜单(Touch
calibration)，选择相应选项后系统直接启动：

    |image11|

2.5 触摸校准
------------

烧写Qt
filesystem后，系统第一次启动时需要对LCD显示进行校准，依次触摸屏幕上的“+”位置完成校准，再次启动后不会在出现校准界面。

2.5.1 重新触摸校准（只支持eMMC版本）
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

如需要重新校准屏幕，有如下两种方法：

方法一：

执行以下命令删除原校准文件：

+----------------------------------------------------+
| root@fl-imx6ull:~# rm -rf /etc/pointercal.xinput   |
|                                                    |
| root@fl-imx6ull:~# sync                            |
+----------------------------------------------------+

硬件reset后或是软件reboot后，根据提示校准即可。

方法二：

用QT程序”Calibrate Touchscreen”进行校准，操作方法如下：

1、开发板启动后，屏幕显示默认进入如下图QT桌面\ |image12|

2、点击菜单栏中的Forlinx，会出现下拉菜单，选择Utilties

|image13|

3、选择Calibrate Touchscreen进入屏幕校准界面

|image14|

4、出现如下界面，依次触摸屏幕上的“+”位置完成校准：

|image15|

2.6 系统分区
------------

-  Linux 操作系统的 4G eMMC 分区信息：

+---------------------+--------------------+---------------+------------+----------------+----------------+
| **分区**            | **名称**           | **偏移**      | **大小**   | **文件系统**   | **内容**       |
+---------------------+--------------------+---------------+------------+----------------+----------------+
| /dev/mmcblk1boot0   | Bootloader         | 1KB           | 2MB        | RAW            | bootloader     |
|                     |                    |               |            |                |                |
|                     | （启动引导分区）   |               |            |                |                |
+---------------------+--------------------+---------------+------------+----------------+----------------+
| /dev/mmcblk1p1      | 内核               | 10MB          | 500MB      | vfat           | Kernel DTB等   |
|                     |                    |               |            |                |                |
|                     | （启动内核）       |               |            |                |                |
+---------------------+--------------------+---------------+------------+----------------+----------------+
| /dev/mmcblk1p2      | 文件系统分区       | Follow Boot   | 剩余       | ext3           | 根文件系统     |
+---------------------+--------------------+---------------+------------+----------------+----------------+

出厂默认磁盘使用情况（使用的qt文件系统），仅供参考，具体参数请以实际为准。

+-------------------------------------------------------+
| root@fl-imx6ull:~# df -m                              |
|                                                       |
| Filesystem 1M-blocks Used Available Use% Mounted on   |
|                                                       |
| /dev/root 3015 733 2126 26% /                         |
|                                                       |
| devtmpfs 79 1 79 1% /dev                              |
|                                                       |
| tmpfs 1 0 1 0% /mnt/.psplash                          |
|                                                       |
| tmpfs 240 1 239 1% /run                               |
|                                                       |
| tmpfs 240 1 239 1% /var/volatile                      |
|                                                       |
| /dev/mmcblk1p1 500 15 486 3% /run/media/mmcblk1p1     |
+-------------------------------------------------------+

不接任何外设情况下的内存使用清楚，仅供参考，具体参数请以实际为准。

+-----------------------------------------------+
| root@fl-imx6ull:~# free                       |
|                                               |
| total used free shared buff/cache available   |
|                                               |
| Mem: 489520 28984 407520 1040 53016 392360    |
|                                               |
| Swap: 0 0 0                                   |
+-----------------------------------------------+

-  Linux 操作系统的 256M NandFlash 分区信息：

+-------------+--------------------+------------+--------------+
| **分区**    | **名称**           | **大小**   | **内容**     |
+-------------+--------------------+------------+--------------+
| /dev/mtd0   | Bootloader         | 4MB        | Bootloader   |
|             |                    |            |              |
|             | （启动引导分区）   |            | uboot        |
+-------------+--------------------+------------+--------------+
| /dev/mtd1   | Logo分区           | 2MB        | logo         |
+-------------+--------------------+------------+--------------+
| /dev/mtd2   | ENV                | 1MB        | ENV          |
+-------------+--------------------+------------+--------------+
| /dev/mtd3   | 设备树分区         | 3MB        | DTB          |
+-------------+--------------------+------------+--------------+
| /dev/mtd4   | 内核               | 8MB        | kernel       |
|             |                    |            |              |
|             | （启动内核）       |            |              |
+-------------+--------------------+------------+--------------+
| /dev/mtd5   | 文件系统分区       | 238MB      | filesystem   |
+-------------+--------------------+------------+--------------+

使用df命令查看系统上磁盘使用情况，df
–m是以MB为单位显示文件系统磁盘空间使用情况。如下图为出厂默认磁盘使用情况（使用的console文件系统），仅供参考，具体参数请以实际为准。

+-------------------------------------------------------------+
| +-------------------------------------------------------+   |
| | root@fl-imx6ull:~# df -m                              |   |
| |                                                       |   |
| | Filesystem 1M-blocks Used Available Use% Mounted on   |   |
| |                                                       |   |
| | /dev/root 236 133 104 56% /                           |   |
| |                                                       |   |
| | devtmpfs 112 0 112 0% /dev                            |   |
| |                                                       |   |
| | tmpfs 112 0 112 0% /run                               |   |
| |                                                       |   |
| | tmpfs 112 0 112 0% /var/volatile                      |   |
| |                                                       |   |
| | root@fl-imx6ull:~#                                    |   |
| +-------------------------------------------------------+   |
+-------------------------------------------------------------+

使用free命令查看内存使用情况，如下图为不接任何外设情况下的内存使用情况，仅供参考，具体参数请以实际为准。

+-----------------------------------------+
| root@fl-imx6ull:~# free                 |
|                                         |
| total used free shared buffers cached   |
|                                         |
| Mem: 230312 31640 198672 176 0 11788    |
|                                         |
| -/+ buffers/cache: 19852 210460         |
|                                         |
| Swap: 0 0 0                             |
|                                         |
| root@fl-imx6ull:~#                      |
+-----------------------------------------+

2.7 系统关闭
------------

一般情况下直接关闭电源即可，如果有数据存储、功能使用等操作，操作过程中不要随意断电，以防出现文件不可逆损坏，只能重新烧写固件。未确保数据完全写入，可输入
sync 命令完成数据同步后再关闭电源。

-  注意：用户依据核心板设计的产品，若在使用中存在意外掉电导致系统异常关闭的情景，可在设计中加入掉电保护等措施。

.. |Image\_20210907115108| image:: .//media/image2.png
   :width: 5.00000in
   :height: 3.96875in
.. |image1| image:: .//media/image3.png
   :width: 4.72917in
   :height: 3.46875in
.. |image2| image:: .//media/image4.png
   :width: 4.72917in
   :height: 4.54167in
.. |image3| image:: .//media/image5.png
   :width: 4.72917in
   :height: 4.56250in
.. |image4| image:: .//media/image6.png
   :width: 2.19792in
   :height: 1.41667in
.. |image5| image:: .//media/image7.png
   :width: 4.71875in
   :height: 2.81250in
.. |image6| image:: .//media/image8.png
   :width: 4.72917in
   :height: 2.71875in
.. |image7| image:: .//media/image9.png
   :width: 3.93750in
   :height: 3.84375in
.. |image8| image:: .//media/image10.png
   :width: 3.93750in
   :height: 3.69792in
.. |image9| image:: .//media/image11.png
   :width: 4.53125in
   :height: 3.01042in
.. |image10| image:: .//media/image12.png
   :width: 4.53125in
   :height: 3.02083in
.. |image11| image:: .//media/image13.png
   :width: 4.53125in
   :height: 3.02083in
.. |image12| image:: .//media/image14.png
   :width: 5.90625in
   :height: 3.54167in
.. |image13| image:: .//media/image15.png
   :width: 5.90625in
   :height: 3.46875in
.. |image14| image:: .//media/image16.png
   :width: 5.90625in
   :height: 3.54167in
.. |image15| image:: .//media/image17.png
   :width: 5.90625in
   :height: 3.54167in
